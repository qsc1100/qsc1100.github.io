<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title></title>
    <style>
        .box-border {
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            transition: 0.3s;
        }
        .box-border.active{
            border: solid 5px red;
            box-shadow: 0 0 20px red;
            transition: 0s;
        }
        
        #msg{
            font-size: 36px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-6 row">
                <div box-id="1" play-sort="1" class="col-4 box-border"></div>
                <div box-id="2" play-sort="2" class="col-4 box-border"></div>
                <div box-id="3" play-sort="3" class="col-4 box-border"></div>
                <div box-id="4" play-sort="6" class="col-4 box-border"></div>
                <div box-id="5" play-sort="5" class="col-4 box-border"></div>
                <div box-id="6" play-sort="4" class="col-4 box-border"></div>
                <div box-id="7" play-sort="7" class="col-4 box-border"></div>
                <div box-id="8" play-sort="8" class="col-4 box-border"></div>
                <div box-id="9" play-sort="9" class="col-4 box-border"></div>
            </div>
            <div class="col-6 row">
                <div money-id="1" play-sort="3" class="col-4 box-border"></div>
                <div money-id="2" play-sort="2" class="col-4 box-border"></div>
                <div money-id="3" play-sort="1" class="col-4 box-border"></div>
                <div money-id="4" play-sort="4" class="col-4 box-border"></div>
                <div money-id="5" play-sort="9" class="col-4 box-border"></div>
                <div money-id="6" play-sort="8" class="col-4 box-border"></div>
                <div money-id="7" play-sort="5" class="col-4 box-border"></div>
                <div money-id="8" play-sort="6" class="col-4 box-border"></div>
                <div money-id="9" play-sort="7" class="col-4 box-border"></div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-5">
                <p class="msg m-0"></p>
            </div>
            <div class="col-2">
                <button>Start</button>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
    </script>
    <script>
        //格子內容
        let elderData = [
            {
                id : '1',
                name : '虎虎生風'
            },
            {
                id : '2',
                name : '富貴安康'
            },
            {
                id : '3',
                name : '福壽雙全'
            },
            {
                id : '4',
                name : '松鶴長春'
            },
            {
                id : '5',
                name : '步步高升'
            },
            {
                id : '6',
                name : '快樂常伴'
            },
            {
                id : '7',
                name : '永保安康'
            },
            {
                id : '8',
                name : '出入平安'
            },
            {
                id : '9',
                name : '壽比南山'
            },
        ]
        let moneyData = [
            {
                id : '1',
                money : '600'
            },
            {
                id : '2',
                money : '1200'
            },
            {
                id : '3',
                money : '2000'
            },
            {
                id : '4',
                money : '600'
            },
            {
                id : '5',
                money : '3600'
            },
            {
                id : '6',
                money : '6000'
            },
            {
                id : '7',
                money : '600'
            },
            {
                id : '8',
                money : '600'
            },
            {
                id : '9',
                money : '12000'
            },
        ]
        let steps_box = 0 //剩下要走的步數
        let steps_money = 0 
        let allSteps_box = 0 //全部要走的步數
        let allSteps_money = 0
        let currentIndex_box = 0 //目前走到哪一格
        let currentIndex_money = 0

        let speed = 50 //速率(越大越慢)
        //DOM
        let bricks_box = document.querySelectorAll('[box-id]')
        let bricks_money = document.querySelectorAll('[money-id]')
        const startBtn = document.querySelector('button')
        const msgShow = document.querySelector('#msg')
        const msg = document.querySelector('.msg')
        
        

        window.onload = function() {
            //排序格子
            bricks_box = Array.from(bricks_box).sort((a,b)=>{
                    return a.getAttributeNode('play-sort').value - b.getAttributeNode('play-sort').value
                })
            //排序格子
            bricks_money = Array.from(bricks_money).sort((a,b)=>{
                    return a.getAttributeNode('play-sort').value - b.getAttributeNode('play-sort').value
                })
            console.log(bricks_box)
            console.log(bricks_money)

            bricks_box.forEach((box,index)=>{
                let id = box.getAttributeNode('box-id').value
                let data = elderData[index].name
                box.innerText = data
            })
            bricks_money.forEach((money,index) =>{
                let id = money.getAttributeNode('money-id').value
                let data = moneyData[index].money
                money.innerText = data
            })
            startBtn.onclick = function(){
                msg.innerText = ""
                speed = 50
                let random_box = Math.floor(Math.random()*elderData.length)+1
                let random_money = Math.floor(Math.random()*moneyData.length)+1
                steps_box = random_box +(3*bricks_box.length)
                steps_money = random_money +(3*bricks_money.length)

                allSteps_box = steps_box
                allSteps_money = steps_money
                bricksAnime()
                turnAround()
            }
        }

        function bricksAnime() {
            bricks_box[currentIndex_box].classList.remove('active')
            currentIndex_box++

            if(currentIndex_box >=bricks_box.length)currentIndex_box = 0

            bricks_box[currentIndex_box].classList.add('active')
            steps_box--

            if(steps_box > 0 ){
                //還沒走完
                setTimeout(bricksAnime,speed)
                //當剩餘步數剩1/3時,減速
                if(steps_box < Math.floor((allSteps_box / 3))) speed +=50 //v2,變速
            }
        }
        function turnAround(){
            bricks_money[currentIndex_money].classList.remove('active')
            currentIndex_money++

            if(currentIndex_money >= bricks_money.length) 
            currentIndex_money = 0

            bricks_money[currentIndex_money].classList.add('active')
            steps_money--

            if(steps_money > 0 ){
                //還沒走完
                setTimeout(turnAround,speed)
                //當剩餘步數剩1/3時,減速
                if(steps_money < Math.floor((allSteps_money / 3))) speed +=0 //v2,變速
                
            }else{
                let final = document.querySelectorAll('.active')
                msg.innerText = `祝您${final[0].innerText}，您獲得的紅包金額是${final[1].innerText}`
            }
        }
        
    

    </script>
</body>
</html>